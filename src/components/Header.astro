---
import { Icon } from "astro-icon/components";
import { menuMain } from "../data/menus.js";
import ThemeToggle from "./ThemeToggle.astro";

const rmTrailingSlash = (path: string): string => {
  return path.endsWith("/") && path.length > 1
    ? path.slice(0, path.length - 1)
    : path;
};

const pathname = rmTrailingSlash(Astro.url.pathname);
---

<header 
  x-data="{ open: false }" 
  @keydown.window.escape="open = false"
  class="header sticky top-0 z-40 w-full bg-primary border-b border-border"
>
  <div class="container py-3">
    <nav class="flex items-center justify-between" aria-label="Global">
      <a href="/" class="flex items-center gap-1 no-underline">
        <span class="font-bold text-xl sm:text-2xl text-primary">
          St. George<span class="text-accent ml-1">Pizza</span>
        </span>
      </a>
      
      <div class="flex lg:hidden items-center gap-1">
        <ThemeToggle />
        <button
          type="button"
          class="inline-flex items-center justify-center rounded-lg p-2 text-secondary hover:text-primary hover:bg-tertiary transition-colors"
          @click="open = true"
          aria-label="Open main menu"
        >
          <Icon name="lucide:menu" class="size-6" aria-hidden="true" />
        </button>
      </div>
      
      <div class="hidden lg:flex lg:gap-x-1 lg:items-center">
        {
          menuMain.map((item) => (
            <a
              href={item.url}
              class:list={[
                "nav-link px-4 py-2 rounded-lg transition-colors text-sm font-semibold no-underline",
                item.highlighted ? "nav-link-cta bg-accent text-surface-950 hover:bg-accent-hover" : "text-secondary hover:text-primary hover:bg-tertiary",
                pathname === item.url && !item.highlighted && "text-accent font-bold"
              ]}
            >
              {item.name}
            </a>
          ))
        }
        <div class="ml-2 pl-2 border-l border-border">
          <ThemeToggle />
        </div>
      </div>
    </nav>
    
    <!-- Mobile menu -->
    <div
      class="lg:hidden"
      x-ref="dialog"
      x-show="open"
      x-cloak
      aria-modal="true"
      role="dialog"
    >
      <div 
        class="fixed inset-0 z-40 bg-black/40"
        x-show="open"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        @click="open = false"
        x-cloak
      ></div>
      
      <div
        class="fixed inset-y-0 right-0 z-50 w-full max-w-xs overflow-y-auto bg-primary px-6 py-5 border-l border-border shadow-lg"
        x-show="open"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="translate-x-full"
        x-transition:enter-end="translate-x-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="translate-x-0"
        x-transition:leave-end="translate-x-full"
        x-cloak
      >
        <div class="flex items-center justify-between">
          <a href="/" class="no-underline" @click="open = false">
            <span class="font-bold text-xl text-primary">
              St. George<span class="text-accent ml-1">Pizza</span>
            </span>
          </a>
          <button
            type="button"
            class="p-2 rounded-lg text-secondary hover:text-primary hover:bg-tertiary transition-colors"
            @click="open = false"
            aria-label="Close menu"
          >
            <Icon name="lucide:x" class="size-6" aria-hidden="true" />
          </button>
        </div>
        
        <nav class="mt-8 space-y-1">
          {
            menuMain.map((item) => (
              <a
                @click="open = false"
                href={item.url}
                class:list={[
                  "block py-3 px-4 rounded-lg font-semibold transition-colors no-underline",
                  item.highlighted ? "bg-accent text-surface-950 text-center hover:bg-accent-hover" : "text-secondary hover:text-primary hover:bg-tertiary",
                  pathname === item.url && !item.highlighted && "text-accent bg-accent-subtle"
                ]}
              >
                {item.name}
              </a>
            ))
          }
        </nav>
      </div>
    </div>
  </div>
</header>

<style>
  .header {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  .nav-link-cta {
    color: var(--color-surface-950);
  }
  .nav-link-cta:hover {
    color: var(--color-surface-950);
  }
  .text-surface-950 {
    color: var(--color-surface-950);
  }
  .bg-accent-hover {
    background-color: var(--color-accent-hover);
  }
</style>
