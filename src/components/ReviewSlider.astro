---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import type { Review } from "../types";
const allReviews: Review[] = await getCollection("reviews");
---

<div class="reviews-swiper w-full mt-6 bg-secondary rounded-lg border border-border">
  <div class="swiper-wrapper h-auto w-auto py-8">
    {
      allReviews.map((review) => (
        <div class="swiper-slide cursor-pointer select-none">
          <div class="px-6 lg:px-10">
            <blockquote class="border-none">
              <div class="flex justify-center gap-0.5 mb-3">
                {[...Array(5)].map(() => (
                  <Icon name="lucide:star" class="size-4 star-icon" aria-hidden="true" />
                ))}
              </div>
              <p class="text-center font-medium text-lg lg:text-xl text-balance text-primary leading-relaxed">
                "{review.data.review}"
              </p>
              <footer class="text-center mt-4 text-secondary text-sm font-medium">
                â€” {review.data.author}
              </footer>
            </blockquote>
          </div>
        </div>
      ))
    }
  </div>
  <div class="reviews-pagination flex justify-center gap-1.5 pb-4"></div>
</div>

<style>
  .star-icon {
    color: var(--color-accent);
    fill: var(--color-accent);
  }
  :global(.reviews-pagination .swiper-pagination-bullet) {
    width: 8px;
    height: 8px;
    background: var(--color-border-secondary);
    opacity: 1;
    border-radius: 4px;
    transition: all 0.2s;
  }
  :global(.reviews-pagination .swiper-pagination-bullet-active) {
    background: var(--color-accent);
    width: 20px;
  }
</style>

<script>
  import Swiper from "swiper";
  import { Pagination, Autoplay } from "swiper/modules";
  import "swiper/css";
  import "swiper/css/pagination";

  function initReviewsSwiper() {
    const swiperEl = document.querySelector(".reviews-swiper") as HTMLElement;
    if (!swiperEl) return;
    
    new Swiper(swiperEl, {
      modules: [Pagination, Autoplay],
      loop: true,
      slidesPerView: 1,
      spaceBetween: 24,
      autoplay: {
        delay: 5000,
        pauseOnMouseEnter: true,
      },
      pagination: {
        el: ".reviews-pagination",
        clickable: true,
      },
    });
  }

  document.addEventListener("astro:page-load", initReviewsSwiper);
  if (document.readyState === "complete" || document.readyState === "interactive") {
    initReviewsSwiper();
  }
</script>
