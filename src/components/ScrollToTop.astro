---
import { Icon } from "astro-icon/components";
---

<button
  id="scroll-to-top"
  type="button"
  class="scroll-to-top"
  aria-label="Scroll to top"
  title="Scroll to top"
>
  <Icon name="lucide:chevron-up" class="size-5" aria-hidden="true" />
</button>

<style>
  .scroll-to-top {
    position: fixed;
    bottom: 5.5rem;
    right: 1rem;
    z-index: 30;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.75rem;
    height: 2.75rem;
    border-radius: 50%;
    background-color: var(--color-bg-elevated);
    border: 1px solid var(--color-border);
    color: var(--color-text-secondary);
    cursor: pointer;
    opacity: 0;
    visibility: hidden;
    transform: translateY(1rem);
    transition: all 0.3s ease;
    box-shadow: var(--shadow-md);
  }
  
  .scroll-to-top:hover {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }
  
  .scroll-to-top:focus {
    outline: none;
  }
  
  .scroll-to-top:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }
  
  .scroll-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  @media (min-width: 1024px) {
    .scroll-to-top {
      bottom: 2rem;
      right: 2rem;
    }
  }
</style>

<script>
  function initScrollToTop() {
    const button = document.getElementById("scroll-to-top");
    if (!button) return;
    
    const scrollThreshold = 300;
    
    function toggleVisibility() {
      if (!button) return;
      if (window.scrollY > scrollThreshold) {
        button.classList.add("visible");
      } else {
        button.classList.remove("visible");
      }
    }
    
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    }
    
    // Initial check
    toggleVisibility();
    
    // Listen for scroll
    window.addEventListener("scroll", toggleVisibility, { passive: true });
    
    // Click handler
    button.addEventListener("click", scrollToTop);
  }
  
  // Initialize on page load
  document.addEventListener("astro:page-load", initScrollToTop);
  
  // Also initialize on DOMContentLoaded for first load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initScrollToTop);
  } else {
    initScrollToTop();
  }
</script>
